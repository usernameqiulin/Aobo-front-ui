(function(g, d) {
	var f = {};
	d = function(a) {
		f = a;
		this.key = a.key || "";
		this.selector = a.selector || "#nb_content";
		this.complete = a.complete || function() {};
		this.bannerData = a.bannerData || [];
		this.wallet = a.wallet || 0;
		this.unLoginCallback = a.unLoginCallback;
		this.betSuccessCallback = a.betSuccessCallback;
		this.betFailCallback = a.betFailCallback;
		this.rightAdData = a.rightAdData || [];
		this.changeThemeCallback = a.changeThemeCallback || null;
		this.openSetBefore = a.openSetBefore;
		this.saveSetAfter = a.saveSetAfter;
		this.languageCallback = a.languageCallback;
		this.version = "?v=2.2";
		this.file_code = [];
		this.client_path = "";
		this.source_path = "";
		this.html_url = "";
		var self = this;
		
		var server_config = "http://uat.config.nbbets.com/server_config.js"; 
		
	   this.apiParamInit();
		$.getScript(server_config,function(){
			var c_index = null;
			if(NBServer.p_mark){
				for (var i = 0; i < NBServer.p_mark.length; i++) {
			        if ($(NBServer.p_mark[i]).length) {
			            c_index = i;
			            break;
			        }
			    }
			}
			else if(NBServer.c_index > -1){
				c_index = NBServer.c_index;
			}
			
			if(c_index == null){
				alert("请跟平台方确定好页面标记");
				return;
			}
			self.client_path =NBServer.p_a || NBServer["p_a"+c_index];
			self.source_path = NBServer.p_stw || self.client_path;
			self.version = NBServer.p_w_v;
			self.html_url = (NBServer.p_a || NBServer["p_a"+c_index]) + "/index_inte.html" + self.version;
			self.checkKey();
			self.setBannerData();
		});
		
	};
	d.prototype = {
		
		apiParamInit : function(){
			if(typeof(f.themeCallback) == "function"){
				window.NBBet.nbfun_theme = f.themeCallback;
			}
			if(typeof(f.openSetBefore) == "function"){
				window.NBBet.nbfun_openSetBefore = f.openSetBefore;
			}
			if(typeof(f.saveSetAfter) == "function"){
				window.NBBet.nbfun_saveSetAfter = f.saveSetAfter;
			}
			if(typeof(f.languageCallback) == "function"){
				window.NBBet.nbfun_language = f.languageCallback;
			}
			
		},
		loadFileList: function(a, c,client) {
			function l(a, c) {
				if(g(this.file_code, a)) c();
				else {
					var h = d(a),
						b = null;
					".js" == h ? (b = document.createElement("script"), b.src = a) : ".css" == h ? (b = document.createElement("link"), b.href = a, b.type = "text/css", b.rel = "stylesheet") : ".less" == h && (b = document.createElement("link"), b.href = a, b.type = "text/css", b.rel = "stylesheet/less");
					c = c ||
						function() {};
					b.onload = b.onreadystatechange = function() {
						this.readyState && "loaded" !== this.readyState && "complete" !== this.readyState || (c(), k.file_code.push(a))
					};
					document.getElementsByTagName("head")[0].appendChild(b)
				}
			}

			function d(a) {
				return -1 != a.indexOf(".css") ? ".css" : -1 != a.indexOf(".js") ? ".js" : ""
			}

			function g(a, c) {
				if(null != a && 0 < a.length)
					for(var e = a.length, b = 0; b < e; b++)
						if(a[b] == c) return !0;
				return !1
			}
			var k = this,
				e = [];
			var path = k.client_path;
			if(client){
				path = k.source_path;
			}
			"object" === typeof a ? e = a : "object" === typeof a && (e = a.split(","));
			if(null != e && e.length) {
				var f = 0;
				for(a =
					0; a < e.length; a++) l( path+ e[a] + k.version, function() {
					f++;
					f == e.length && c()
				})
			}
		},
		setBannerData: function() {
			this.bannerData && this.bannerData.length ? localStorage.setItem("nb_banner", JSON.stringify(this.bannerData)) : localStorage.removeItem("nb_banner")
		},
		checkKey: function() {
			var a = this;
			this.loadFileList(["/css/nbet.min.css", "/js/base.js"], function() {
				 var config = (localStorage.getItem(Base.user_config) && JSON.parse(localStorage.getItem(Base.user_config))) || Base.user_config_val;
		        if(+config.nb_theme == 1){
		        	a.loadFileList(["/css/themes/white.min.css"],function(){
		        		a.renderHtml()
		        	},a.source_path);
		        }else{
		        	a.renderHtml()
		        }
				
			}, a.source_path)
		},
		renderHtml: function() {
			var a = this;
			g.get(this.html_url, function(c) {
				g(a.selector).html(c);
				c = localStorage.getItem("nb_pc_language") || "zh-cn";
				a.loadFileList(["/js/platform/language-" + c + ".js"], function() {
					a.loadFileList(["/js/platform/logic/logic_common.js","/js/platform/logic/push_common.js", "/build/jqMousewheel/jquery.mousewheel.min.js", "/js/platform/init.js"], function() {
						a.loadFileList(["/js/platform/nav.js", "/js/platform/left.js", "/js/platform/controller.js"], function() {
							Nav.init({wallet:a.wallet});
							Left.init();
							Controller.init();
							a.loadFileList(["/js/platform/bet.js"], function() {
								BetBox.init({
									unLoginFun: a.unLoginCallback,
									betSuccessFun: a.betSuccessCallback,
									betFailFun: a.betFailCallback
								});
								a.complete();
								a.rightAdImgRender()
							},a.source_path)
						},a.source_path)
					},a.source_path)
				})
			}, "html")
		},
		rightAdImgRender: function() {
			if(this.rightAdData && this.rightAdData.length) {
				var a = "";
				$.each(this.rightAdData, function(c, d) {
					a += '<div class="nb_betImg"><a href="' + d.href + '" target="_blank"><img title="' + d.title + '" alt="' + d.title + '" src="' + d.img + '" /></a></div>'
				});
				$("#nb_right_ad").html(a)
			}else{
				$("#nb_right_ad").html("");
			}
		}
	};
	d.init = function(a) {
		return new this(a)
	};
	window.NBBet = d;
	NBBet.refreshBet = function(){
		$("#nb_refresh_bet").click();
	}
	NBBet.gotoPage = function(a) {
		var c = +JSON.parse(localStorage.getItem("nb_config_v4")).nb_view ? "index/asia gq/asia today/asia morn/asia football/asia basketball/asia tennis/asia".split(" ") :
			"index/europe gq/europe today/europe morn/europe football/europe basketball/europe tennis/europe".split(" ");
		$("a[data-href='" + (c[a] || c[0]) + "']").click()
	};
	NBBet.clearUserInfo = function(a) {
		localStorage.removeItem("nb_user");
		a && a()
	};
	NBBet.destory = function() {
		$("#nb_inner_content").remove()
	};
	NBBet.reRender = function() {
		$("#nb_inner_content").remove();
		$("body").unbind("click");
		$("body").unbind("keyup");
		$("body").unbind("blur");
		NBBet.init(f)
	}
})(window.$, window);