import React from 'react'
import PropTypes from 'prop-types'
import {connect} from 'react-redux'
import {Redirect, Route, Switch} from 'react-router-dom'
import {translate} from 'react-i18next'
import {Helmet} from "react-helmet"

import ScrollToTopOnMount from "../../Components/ScrollToTopOnMount"

import Index from "./Index/index"
import AccountNav from "../../Components/Account/Nav"
import Profile from "./Profile"
import Coupon from "./Coupon"
import Deposit from "./Deposit"
import Withdraw from "./Withdraw"
import Transfer from "./Transfer"
import Transaction from "./Transaction"
import Rebate from "./Rebate"
import Bigwin from "./Bigwin"
import Record from "./Record"
import Favorite from "./Favorite"
import Relief from "./Relief"
import Members from './Affiliate/MembersTry'
import Gross from './Affiliate/GrossTry'
import NotFound from "../NotFound"
import Visitors from "./Affiliate/Visitors"
import Charges from './Affiliate/Charges';
import History from './Affiliate/History';

import MainWallet from "../../Components/Account/MainWallet"
import Wallet from "../../Components/Account/Wallet"

import WalletActions from '../../Redux/WalletRedux'
import ABSpinner from "../../Components/ABSpinner"

const AccountNavWithScroll = translate()(AccountNav)

class Account extends React.Component {

    componentWillMount() {
        // if (!this.props.isLoggedin()) {
        //     alert('not logged in')
        // }
    }

    refresh = (code) => {
        if (this.props.wallet.updating) {
            return
        }
        this.props.updateWallet(code)
    }

    render() {
        const {t, wallet} = this.props
        return !this.props.isLoggedin()
         ? (
                <Redirect
                    to={{
                        pathname: "/",
                        state: { from: this.props.location }
                    }}
                />
            )
         : (
            <React.Fragment>
                <svg style={{width: 0, height: 0, overflow: 'hidden', position: 'fixed', visibility: 'hidden'}}>
                    <symbol preserveAspectRatio="xMidYMax meet" viewBox="0 0 8.2 15" id="icon-arrow">
                        <polyline points="0.7,0 0,0.7 6.8,7.5 0,14.3 0.7,15 8.2,7.5 "/>
                    </symbol>
                    <symbol preserveAspectRatio="xMidYMax meet" viewBox="0 0 7 7" id="icon-down">
                        <path className="st0" d="M0,4V3l3.5,3L7,3v1L3.5,7L0,4z"/>
                        <path className="st0" d="M0,1V0l3.5,3L7,0v1L3.5,4L0,1z"/>
                    </symbol>
                    <symbol preserveAspectRatio="xMidYMax meet" viewBox="-571 791.9 21 27" id="icon-padlock">
                        <g>
                            <path className="st00"
                                  d="M-560.5,794.9c-2.5,0-4.5,2-4.5,4.5v3.5h9v-3.5C-556,796.9-558,794.9-560.5,794.9z"/>
                            <path
                                d="M-553,802.9v-3.5c0-4.1-3.4-7.5-7.5-7.5c-4.1,0-7.5,3.4-7.5,7.5v3.5c-1.7,0-3,1.3-3,3v10c0,1.7,1.3,3,3,3h15c1.7,0,3-1.3,3-3v-10C-550,804.2-551.3,802.9-553,802.9z M-559.7,810.4v4.4c0,0.4-0.3,0.8-0.8,0.8c-0.4,0-0.8-0.3-0.8-0.8v-4.4c-1-0.3-1.7-1.3-1.7-2.4c0-1.4,1.1-2.5,2.5-2.5c1.4,0,2.5,1.2,2.5,2.5C-558,809.1-558.7,810.1-559.7,810.4z M-556,802.9h-9v-3.5c0-2.5,2-4.5,4.5-4.5s4.5,2,4.5,4.5V802.9z"/>
                            <path className="st01"
                                  d="M-560.5,805.5c-1.4,0-2.5,1.1-2.5,2.5c0,1.1,0.7,2.1,1.7,2.4v4.4c0,0.5,0.4,0.8,0.8,0.8c0.5,0,0.8-0.4,0.8-0.8v-4.4c1-0.3,1.7-1.3,1.7-2.4C-558,806.7-559.1,805.5-560.5,805.5z"/>
                        </g>
                    </symbol>
                    <symbol preserveAspectRatio="xMidYMax meet" viewBox="0 0 14 14" id="icon-plus">
                        <path
                            d="M7,0C3.1,0,0,3.1,0,7c0,3.9,3.1,7,7,7s7-3.1,7-7C14,3.1,10.9,0,7,0z M10,8H8v2H6V8H4V6h2V4h2v2h2V8z"/>
                    </symbol>
                    <symbol preserveAspectRatio="xMidYMax meet" viewBox="0 0 24.248 32" id="icon-shield">
                        <path
                            d="M12.124,0.001L12.124,0.001C11.876,0.263,6.784,5.588,0,6.284v9.377c0,0-0.083,11.379,12.124,16.338v0c12.207-4.959,12.124-16.338,12.124-16.338V6.285C17.464,5.588,12.372,0.264,12.124,0.001z"/>
                    </symbol>
                    <symbol preserveAspectRatio="xMidYMax meet" viewBox="0 0 45 41" id="icon-tux">
                        <path
                            d="M44.4,27.3c-1,0.7-3.2-0.6-4.4-1.3c-1.1-0.7-2-0.5-2-0.5l0,0c0,2.1-1.3,5.7-1.9,7.1l0,0l-0.6,1.4c2.1,0.6,5.3,1.7,5.3,2.9c0,0,0,0.1,0,0.1c0.1,0.2,0.1,0.5,0.1,0.7c0,1.8-1.8,3.3-3.9,3.3h-9.7c-1.4,0-2.6-0.6-3.3-1.5h-3.1C20.2,40.4,19,41,17.6,41H8c-2.2,0-3.9-1.5-3.9-3.4c0-0.2,0-0.5,0.1-0.7c0,0,0-0.1,0-0.1c0-1.2,3.2-2.4,5.3-3l-0.6-1.5l0,0c-0.6-1-1.9-4.9-1.9-6.9l0,0.1c0,0-0.9-0.2-2,0.5c-1.1,0.7-3.4,2.1-4.3,1.3c-1-0.7-0.5-1.3,0.2-2.2c0.8-0.9,8.1-7,8.3-8.7c0.2-1.7,0.5-7.4,0.7-8C10,7.7,12.4,0.2,22.2,0v0c0,0-0.6,0-1.2,0c0,0,0,0,0,0c0.2,0,0.5,0,0.7,0c0.2,0,0.5,0,0.8,0c0.3,0,0.5,0,0.8,0c0.2,0,0.4,0,0.6,0c0,0,0,0,0,0c-0.6,0-1.1,0-1.1,0v0C33.1,0.2,35,7.7,35.2,8.3c0.2,0.6,0.6,6.3,0.7,8c0.2,1.7,7.5,7.8,8.3,8.7C45,26,45.4,26.6,44.4,27.3z M28,15.6c1.3-0.6,2.3-2,2.3-3.5c0-2.1-1.7-3.9-3.7-3.9c-1.5,0-2.8,0.9-3.4,2.3l-0.6-0.7l-0.6,0.7c-0.6-1.3-1.9-2.3-3.4-2.3c-2.1,0-3.7,1.7-3.7,3.9c0,1.6,0.9,3,2.3,3.5 M19.2,16.1L19.2,16.1c0-0.1-0.1-0.3-0.1-0.4c0-0.1,0-0.1,0-0.2c0-0.2,0.1-0.3,0.2-0.5c0.5-0.5,1.2-0.9,1.4-0.9h1.6h1.5c0.2,0,0.8,0.5,1.3,0.9c0.1,0.1,0.2,0.3,0.2,0.4c0,0.2,0,0.3,0,0.5 M25.4,16.3L25.4,16.3c-0.1,0.2-0.1,0.3-0.1,0.3s-1.5,2-2,2.6c-0.5,0.6-0.9,0.5-0.9,0.5s-0.5,0.1-1-0.5c-0.5-0.6-2-2.6-2-2.6s0-0.1-0.1-0.2l0,0c-5,4-6.3,13.3-6,15.2c0,0.2,0.1,0.5,0.2,0.8c0.7-0.1,0.2,1,1.2,1c3.7,0,6.5,1.4,6.9,3.2c0.2,0.3,0.2,0.6,0.2,0.9c0,0.4-0.1,0.7-0.3,1h2c-0.2-0.3-0.3-0.6-0.3-1c0-0.4,0.2-0.8,0.4-1.1c0.7-1.7,3.3-3,6.8-3c1,0,0.5-1.1,1.2-1c0.1-0.3,0.1-0.5,0.2-0.8C32,29.6,31.1,20.8,25.4,16.3z M23.8,13.1c-0.4,0-0.8-0.7-0.8-1.6c0-0.9,0.4-1.6,0.8-1.6s0.8,0.7,0.8,1.6C24.6,12.4,24.3,13.1,23.8,13.1z M21.2,13.1c-0.4,0-0.8-0.7-0.8-1.6c0-0.9,0.4-1.6,0.8-1.6c0.4,0,0.8,0.7,0.8,1.6C22,12.4,21.6,13.1,21.2,13.1z"/>
                    </symbol>
                    <symbol preserveAspectRatio="xMidYMax meet" viewBox="0 0 14 12" id="icon-reload">
                        <g fillRule="nonzero">
                            <path d="M13.9628571,5.52714286 L13.1914286,6.88571429 L12.41,8.26285714 L12.4085714,8.26285714 C12.37,8.32571429 12.3014286,8.36857143 12.2214286,8.36857143 C12.1414286,8.36857143 12.07,8.32428571 12.0314286,8.25857143 L12.0314286,8.25857143 L11.2542857,6.88571429 L10.4814286,5.52285714 C10.46,5.48857143 10.4471429,5.44714286 10.4471429,5.40428571 C10.4471429,5.28 10.5457143,5.18 10.6685714,5.18 L11.68,5.18 C11.2971429,2.91714286 9.36,1.19714286 7.02857143,1.19714286 C6.12,1.19714286 5.27142857,1.45857143 4.55142857,1.91142857 C4.45428571,1.98142857 4.33571429,2.02428571 4.20857143,2.02428571 C3.88285714,2.02428571 3.61857143,1.75571429 3.61857143,1.42428571 C3.61857143,1.19714286 3.74428571,0.998571429 3.92714286,0.897142857 C4.82857143,0.328571429 5.89142857,0 7.03,0 C10.0142857,0 12.4785714,2.25285714 12.8728571,5.17857143 L13.78,5.17857143 C13.9014286,5.17857143 14,5.27857143 14,5.40285714 C14,5.44857143 13.9857143,5.49142857 13.9628571,5.52714286 Z M3.33142857,5.87571429 L2.31,5.87571429 C2.30857143,5.91714286 2.30857143,5.95714286 2.30857143,6 C2.30857143,8.65285714 4.42142857,10.8028571 7.02857143,10.8028571 C8.09142857,10.8028571 9.07142857,10.4457143 9.86142857,9.84142857 C9.86142857,9.84142857 9.86142857,9.84285714 9.86285714,9.84285714 C9.96857143,9.74142857 10.11,9.68 10.2657143,9.68 C10.5914286,9.68 10.8557143,9.94857143 10.8557143,10.28 C10.8557143,10.4571429 10.78,10.6185714 10.6585714,10.7285714 C10.6585714,10.7285714 10.6585714,10.7285714 10.6585714,10.73 C10.6542857,10.7328571 10.65,10.7371429 10.6457143,10.74 C10.6314286,10.7514286 10.6157143,10.7628571 10.6014286,10.7742857 C9.61,11.5428571 8.37285714,12 7.03,12 C3.77285714,12 1.13285714,9.31285714 1.13285714,6 C1.13285714,5.95857143 1.13285714,5.91714286 1.13428571,5.87428571 L0.22,5.87428571 C0.0985714286,5.87428571 0,5.77428571 0,5.65 C0,5.60571429 0.0128571429,5.56428571 0.0342857143,5.53 L0.808571429,4.16714286 L1.58714286,2.79571429 L1.58714286,2.79571429 C1.62571429,2.73 1.69571429,2.68571429 1.77571429,2.68571429 C1.85428571,2.68571429 1.92428571,2.72714286 1.96285714,2.79142857 L1.96428571,2.79142857 L2.74571429,4.16714286 L3.51714286,5.52714286 C3.54,5.56285714 3.55285714,5.60571429 3.55285714,5.65142857 C3.55285714,5.77571429 3.45428571,5.87571429 3.33142857,5.87571429 Z"/>
                        </g>
                    </symbol>
                    <symbol preserveAspectRatio="xMidYMax" viewBox="0 0 14 16" id="icon-delete">
                        <path d="M5.09000015,12.4068754 L5.09000015,5.40812516 C5.09000015,5.3153387 5.06017593,5.23912125 5.00052749,5.17947281 C4.94087905,5.11982437 4.8646616,5.09000015 4.77187514,5.09000015 L4.13562512,5.09000015 C4.04283866,5.09000015 3.96662121,5.11982437 3.90697277,5.17947281 C3.84732433,5.23912125 3.81750011,5.3153387 3.81750011,5.40812516 L3.81750011,12.4068754 C3.81750011,12.4996618 3.84732433,12.5758793 3.90697277,12.6355277 C3.96662121,12.6951762 4.04283866,12.7250004 4.13562512,12.7250004 L4.77187514,12.7250004 C4.8646616,12.7250004 4.94087905,12.6951762 5.00052749,12.6355277 C5.06017593,12.5758793 5.09000015,12.4996618 5.09000015,12.4068754 Z M7.63500023,12.4068754 L7.63500023,5.40812516 C7.63500023,5.3153387 7.60517601,5.23912125 7.54552757,5.17947281 C7.48587913,5.11982437 7.40966168,5.09000015 7.31687522,5.09000015 L6.6806252,5.09000015 C6.58783874,5.09000015 6.51162129,5.11982437 6.45197285,5.17947281 C6.39232441,5.23912125 6.36250019,5.3153387 6.36250019,5.40812516 L6.36250019,12.4068754 C6.36250019,12.4996618 6.39232441,12.5758793 6.45197285,12.6355277 C6.51162129,12.6951762 6.58783874,12.7250004 6.6806252,12.7250004 L7.31687522,12.7250004 C7.40966168,12.7250004 7.48587913,12.6951762 7.54552757,12.6355277 C7.60517601,12.5758793 7.63500023,12.4996618 7.63500023,12.4068754 Z M10.1800003,12.4068754 L10.1800003,5.40812516 C10.1800003,5.3153387 10.1501761,5.23912125 10.0905276,5.17947281 C10.0308792,5.11982437 9.95466176,5.09000015 9.8618753,5.09000015 L9.22562528,5.09000015 C9.13283882,5.09000015 9.05662137,5.11982437 8.99697293,5.17947281 C8.93732449,5.23912125 8.90750027,5.3153387 8.90750027,5.40812516 L8.90750027,12.4068754 C8.90750027,12.4996618 8.93732449,12.5758793 8.99697293,12.6355277 C9.05662137,12.6951762 9.13283882,12.7250004 9.22562528,12.7250004 L9.8618753,12.7250004 C9.95466176,12.7250004 10.0308792,12.6951762 10.0905276,12.6355277 C10.1501761,12.5758793 10.1800003,12.4996618 10.1800003,12.4068754 Z M4.77187514,2.54500008 L9.22562528,2.54500008 L8.74843776,1.38185551 C8.70204453,1.32220707 8.64570989,1.28575525 8.57943385,1.27250004 L5.42800798,1.27250004 C5.36173193,1.28575525 5.30539729,1.32220707 5.25900406,1.38185551 L4.77187514,2.54500008 Z M13.9975004,2.86312509 L13.9975004,3.4993751 C13.9975004,3.59216157 13.9676762,3.66837902 13.9080278,3.72802746 C13.8483793,3.78767589 13.7721619,3.81750011 13.6793754,3.81750011 L12.7250004,3.81750011 L12.7250004,13.2419535 C12.7250004,13.7920447 12.5692517,14.2675753 12.2577543,14.6685454 C11.9462569,15.0695154 11.5717972,15.2700005 11.1343753,15.2700005 L2.86312509,15.2700005 C2.4257032,15.2700005 2.05124355,15.076143 1.73974615,14.6884282 C1.42824874,14.3007133 1.27250004,13.8318103 1.27250004,13.2817191 L1.27250004,3.81750011 L0.31812501,3.81750011 C0.225338548,3.81750011 0.149121098,3.78767589 0.0894726589,3.72802746 C0.0298242196,3.66837902 0,3.59216157 0,3.4993751 L0,2.86312509 C0,2.77033862 0.0298242196,2.69412117 0.0894726589,2.63447274 C0.149121098,2.5748243 0.225338548,2.54500008 0.31812501,2.54500008 L3.39001963,2.54500008 L4.08591809,0.884785183 C4.18533216,0.639563821 4.36427747,0.430794284 4.62275404,0.25847657 C4.88123062,0.0861588567 5.14302099,0 5.40812516,0 L8.58937526,0 C8.85447943,0 9.1162698,0.0861588567 9.37474637,0.25847657 C9.63322295,0.430794284 9.81216826,0.639563821 9.91158233,0.884785183 L10.6074808,2.54500008 L13.6793754,2.54500008 C13.7721619,2.54500008 13.8483793,2.5748243 13.9080278,2.63447274 C13.9676762,2.69412117 13.9975004,2.77033862 13.9975004,2.86312509 Z"/>
                    </symbol>
                    <symbol preserveAspectRatio="xMidYMax" viewBox="0 0 25 22" id="icon-wallet">
                        <path d="M2.25350492,4.40860351 C2.26427896,4.40897016 2.32894598,4.40897016 2.44750597,4.40860351 L20.8291052,4.40860351 L20.974606,4.40860351 C21.0702718,4.42853669 21.1699371,4.42853669 21.2656075,4.40860351 L21.3626081,4.40860351 L22.5751146,4.40860351 C22.9880559,4.40860351 23.3026185,4.72767619 23.3026185,5.14665097 L23.3026185,19.8091939 C23.3026185,20.2281687 22.9882422,20.5472414 22.5751146,20.5472414 L2.30200518,20.5472414 C1.88887638,20.5472414 1.57450125,20.2281687 1.57450125,19.8091939 L1.57450125,5.14665097 C1.57450125,4.7415318 1.86118715,4.42875712 2.25350492,4.40860351 Z M21.1573606,0.00618562183 L2.16493922,2.95837547 L2.06653289,2.95837547 C1.91942472,2.98197268 1.78005019,3.05165995 1.67290758,3.15518813 C1.65574079,3.17079884 1.63931512,3.1872245 1.62370442,3.20439129 C0.717237484,3.47678001 0,4.13358321 0,5.12331469 L0,19.7858576 C0,20.9923979 0.958620823,22 2.16493922,22 L22.7318618,22 C23.9381801,22 24.8968011,20.9923979 24.8968011,19.7858576 L24.8968011,15.6035887 C24.9056183,15.5383728 24.9056183,15.4719918 24.8968011,15.406776 L24.8968011,9.45319314 C24.901682,9.40415687 24.901682,9.35461991 24.8968011,9.30558365 L24.8968011,5.12331469 C24.8968011,3.91677438 23.9383691,2.95837547 22.7318618,2.95837547 L21.9938144,2.95837547 L21.9938144,0.744233084 C22.0004855,0.321863204 21.5756127,-0.0530240804 21.1573606,0.00618562183 Z M20.5177195,1.62989004 L20.5177195,2.95837547 L11.6611499,2.95837547 L20.5177195,1.62989004 Z M16.8274821,10.3096093 C15.5761036,10.3096093 14.584099,11.3016163 14.584099,12.5529925 C14.584099,13.8043687 15.5761036,14.7963757 16.8274821,14.7963757 C18.0788578,14.7963757 19.0708653,13.8043687 19.0708653,12.5529925 C19.0708653,11.3016163 18.0788578,10.3096093 16.8274821,10.3096093 Z"/>
                    </symbol>
                </svg>
                <Helmet>
                    <body className={`account-page`}/>
                </Helmet>
                <ScrollToTopOnMount/>
                <div className="nav-spacer menu-spacer"/>
                {/* Wallet lp */}
                <div className="wallet-lp wallet-lp--galaxy">
                    <div className="nav-spacer menu-spacer"/>
                    <div className="container account">
                        <div className="page-header module-header cf">
                            <div className="module-header-in cf">
                                <div className="header__switches cf"/>
                                <div className="header__main">
                                    {this.props.isLoggedin() && <AccountNavWithScroll/>}
                                </div>
                            </div>
                        </div>
                    </div>
                    <ABSpinner hidden={!wallet.fetching} size={'big'} color={'light'}/>
                    <div className={`container account cf${wallet.fetching ? ' ng-hide' : ''}`}>
                        {
                            this.props.wallet.main
                            && <MainWallet
                                processing={wallet.updating}
                                wallet={wallet.main}
                                refresher={this.refresh}
                            />
                        }
                        <div className="wallet-add-funds">
                            <h2 className="module-header module-header--wallet">{t('game wallet')}</h2>
                            <div className={`wallet-amount-selector`}>
                                <div className="wallet-amount-selector__message-box ng-hide">
                                    <p className="wallet-amount-selector__message-text">
                                        <b className="wallet-amount-selector__message-strong">
                                            您所选择的货币在您当前的地区不可用。
                                        </b>
                                        请切换到另一种货币。若您认为发生了错误，请 <a href="/support/contact" className="wallet-amount-selector__message-link">联系我们的客服团队</a>。
                                    </p>
                                </div>
                                <div style={{textAlign: 'left'}}>
                                    {!!wallet.other && wallet.other.map((w, i) => {
                                        return <Wallet
                                            wallet={w}
                                            index={i}
                                            key={i}
                                            refresher={this.refresh}
                                            processing={wallet.updating}
                                        />
                                    })}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {/* end Wallet lp */}
                <Switch>
                    <Route exact path='/account' component={Index}/>
                    <Route path={`/account/profile`} component={Profile}/>
                    <Route path={`/account/coupon`} component={Coupon}/>
                    <Route path={`/account/favorite`} component={Favorite}/>
                    <Route path={`/account/deposit`} component={Deposit}/>
                    <Route path={`/account/withdraw`} component={Withdraw}/>
                    <Route path={`/account/transfer`} component={Transfer}/>
                    <Route path={`/account/transactions`} component={Transaction}/>
                    <Route path={`/account/rebate`} component={Rebate}/>
                    <Route path={`/account/bigwin`} component={Bigwin}/>
                    <Route path={`/account/records`} component={Record}/>
                    <Route path={`/account/relief`} component={Relief}/>
                    <Route path={`/account/members`} component={Members}/>
                    <Route path={`/account/gross`} component={Gross}/>
                    <Route path={`/account/visitors`} component={Visitors}/>
                    <Route path={`/account/charges`} component={Charges}/>
                    <Route path={`/account/history`} component={History}/>
                    <Route component={NotFound}/>
                </Switch>
            </React.Fragment>
        )
    }
}

Account.propTypes = {
    wallet: PropTypes.object.isRequired,
    updateWallet: PropTypes.func.isRequired,
}

const mapStateToProps = (state) => {
    return {
        wallet: state.wallet,
    }
}

const mapDispatchToProps = (dispatch) => ({
    updateWallet: (code) => dispatch(WalletActions.walletUpdateRequest(code))
})


export default connect(mapStateToProps, mapDispatchToProps)(translate()(Account))